## 何为存储过程？
**定义：**

存储过程（Stored Procedure）是一种在数据库中存储复杂程序，以便外部程序调用的一种数据库对象。
存储过程是为了完成特定功能的SQL语句集，经编译创建并保存在数据库中，用户可通过指定存储过程的名字并给定参数(需要时)来调用执行。
存储过程思想上很简单，就是数据库 SQL 语言层面的代码封装与重用。

以下是一段存储过程示例:
```sql
CREATE PROCEDURE delete_matches(IN p_playerno INTEGER)
BEGIN
DELETE FROM MATCHES
WHERE playerno = p_playerno;
END
```
其形式同 Java中的函数很像。有函数名，返回值。存储过程中的begin和end相当于Java中的{ }。

## 开发人员为何不允许使用存储过程？

Alibaba开发手册中对存储过程的使用给出【强制】 限制级:
![](img/Snipaste_2023-08-26_09-27-50.png)

任何技术都要分使用场景

**存储过程优点：性能高**

通常，使用存储过程会比在库外用 Java 指挥 SQL 完成数据处理性能更好一点。这个原因主要在于数据不出库。外部程序访问库内数据时必须通过数据库提供的接口，而这些接口的性能大都不好，特别是面向 Java 程序的 JDBC 接口。每次发出 SQL 让数据库执行都会调用这个接口，速度就上不去。如果应用程序和数据库不在同一台物理机器上时，还会有一些网络延迟，不过和接口的低性能相比并不算严重。在外部计算时，从数据库获取数据的时间常常会超过计算本身的时间。存储过程的性能好主要得益于数据库低效的访问接口。总结一下。存储过程的优点主要来源于两方面：一是 SQL 的数据处理能力，至少目前来看结构化数据处理尤其是复杂计算，SQL 仍然比 Java 强很多。二是库内计算的便利，数据不用出库省下的 IO 成本对数据密集型任务有莫大优势。

**缺点：移植性差**

存储过程的移植确实很困难，一般业务逻辑复杂到需要写存储过程的地步，总会不可避免地用到数据库独有的特性和语法，更换数据库时这部分代码就需要重写。如果只是简单地替换函数名和参数规则（如日期转换等），那成本还不高；如果用到了新数据库不支持的某种特性，那还要重新设计算法来编写计算逻辑；如果还要再兼顾性能因素，有时候就会是个不可能完成的任务了。

**调试困难**

编辑调试是个大问题，存储过程的开发一直缺少有效的 IDE 环境。SQL 本身经常很长，调试时要把句子拆开分别独立执行，非常麻烦。存储过程中也常常有大量的长 SQL，当然也有同样的问题。即使是分步的运算，因为没有好的 IDE 支持，要看哪一步出错，也要把中间结果输出才行，仍然是非常麻烦。存储过程的调试功能近年来略有起色，但离流畅使用始终差距甚远，数据库厂商似乎也无心解决。这和 Java 等拥有成熟的开发环境完全不可同日而语。困难的调试自然会导致低下的开发效率。

### 附件
[阿里巴巴java开发手册嵩山版](阿里巴巴java开发手册嵩山版.pdf)